Здесь можно было бы втащить outbox и работать через гарантированные транзакционно задания. Но хорошая ли это идея? Учитывая, что после отправки сообщения в зону ответственности поставщика услуг транспорта, мы всё равно не можем гарантировать доставку - то проще считать, что пользователь, в принципе, может подождать и жмякнуть лишний раз по "выслать повторно".

Да и учитывая, что outbox гарантирует отправку `1+` раз, а нам больше подходит `0-1`, то проще оставить так.


Таблица подтверждений выглядит соответственно:

| id: pk | code : varchar | user_id : varchar/int/uuid | operation: string | expires_at: datetime | executed: bool |
|--------|----------------|----------------------------|-------------------|----------------------|----------------|

- `id` - чтобы было )
- `code` - непосредственно код
- `user_id` - чтобы знать чей
- `operation` - чтобы знать почему
- `expires_at` - чтобы не жил вечно
- `executed` - чтобы было понятно, что он уже использован

Составной индекс в порядке убывания вариантов: `user_id > code > operation`. Хотя тут зависит от того, что мы будем записывать в `operation`, конечно. Если мы будем хранить там идентификатор действия пользователя, то можно наоборот на первое место его поставить.
